<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	<select id="list" resultType="vo.BoardVO" parameterType="Integer">
		SELECT *, (SELECT nickname FROM mingo.user WHERE user_id=mingo.board.user_id)
		 AS nickname FROM mingo.board WHERE type = #{type}
		
		ORDER BY board_id DESC
		LIMIT #{startIndex},#{limit}
	
	</select>
	
	
   <select id="count" resultType="Integer" parameterType="Integer">
	SELECT COUNT(*) FROM mingo.board where type =#{type}
	
	</select>
	
	<insert id="insert" parameterType="vo.BoardVO" useGeneratedKeys="true">
		INSERT INTO mingo.board
		(board_id, user_id, type, title, contents, regdate, readcount)
		values
		(#{board_id}, 1, #{type}, #{title}, #{contents}, NOW(),#{readcount})
		<selectKey keyProperty="board_id" resultType="Integer" order="AFTER">
			SELECT last_insert_id()
		</selectKey>
	</insert>
	
	
	<select id="view" parameterType="Integer" resultType="vo.BoardVO">
		SELECT *, (SELECT nickname FROM mingo.user WHERE user_id=mingo.board.user_id)
		 AS nickname FROM mingo.board WHERE board_id=#{board_id}
	</select>
	
	<update id="update" parameterType="vo.BoardVO" >
		UPDATE mingo.board SET title=#{title}, contents=#{contents} WHERE board_id=#{board_id}
	</update>
	
	<delete id="delete" parameterType="Integer">
		DELETE FROM mingo.board WHERE board_id=#{board_id}
	</delete>
	
	<update id="readcount" parameterType="Integer">
		UPDATE mingo.board SET readcount=readcount+1 WHERE board_id=#{board_id}
	</update>
	
	<select id="clist" resultType="vo.BoardCommentVO" parameterType="Integer">
		SELECT * FROM mingo.board_comment WHERE board_id=#{board_id}
		ORDER BY ref DESC, seq ASC
		
	</select>
	
	<update id="replySeq" parameterType="vo.BoardCommentVO">
		UPDATE mingo.board_comment SET seq=seq+1 WHERE
		 ref=#{ref} AND seq > #{seq}
	</update>
	
	<insert id="writeComment" parameterType="vo.BoardCommentVO" useGeneratedKeys="true">
		INSERT INTO mingo.board_comment
		(board_comment_id,user_id, board_id, regdate,
		ref, lev, seq, contents)
		values
		(#{board_comment_id}, 1, #{board_id},NOW(), 
		#{board_id}, #{lev} , #{seq} ,#{contents})
		<selectKey keyProperty="board_comment_id" resultType="Integer" order="AFTER">
			SELECT last_insert_id()
		</selectKey>
	</insert>
	
	<insert id="replyInsert" parameterType="vo.BoardCommentVO">
		INSERT INTO mingo.board_comment
		(user_id, board_id, regdate,
		ref, lev, seq, contents)
		values
		(1, #{board_id},NOW(), 
		#{ref}, #{lev} , #{seq} ,#{contents})
	</insert>
	
	<delete id="replyDelete" parameterType="Integer">
		DELETE FROM mingo.board_comment WHERE board_comment_id=#{board_comment_id}
	</delete>
	
	<select id="countCommentList" parameterType="Integer" resultType="Integer">
		select count(*) from board_comment where board_id = #{board_id}
	</select>
	
	<insert id="registLike" parameterType="vo.LikeBoardVO">  
		insert into mingo.like_board
		(user_id, board_id)
		values
		(#{user_id}, #{board_id})
	</insert> 
	<delete id="deleteLike" parameterType="vo.LikeBoardVO">  
		DELETE FROM mingo.like_board WHERE board_id=#{board_id} and user_id=#{user_id}
	</delete>
	<update id="refUpdate" parameterType="Integer">
		UPDATE mingo.board_comment SET ref=#{board_comment_id} WHERE board_comment_id=#{board_comment_id}
	</update>
</mapper>